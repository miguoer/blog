# Node ç«¯å®ç° DI å’Œ IOC

IOCï¼ˆInversion Of Controlï¼‰æ§åˆ¶åè½¬æ˜¯ä¸€ç§æ€æƒ³ã€‚æ­£å¸¸å†™ä»£ç æ˜¯ç”¨åˆ°è°å°±å»æ‰¾è°ã€‚ç”±æˆ‘ä»¬å»åˆ›å»ºéœ€è¦ä¾èµ–çš„å¯¹è±¡ã€‚è€Œ IOC æ˜¯æœ‰ä¸€ä¸ªä¸“é—¨çš„å®¹å™¨æ¥åˆ›å»ºè¿™äº›å¯¹è±¡ï¼Œå³ç”± IOC å®¹å™¨æ§åˆ¶å¯¹è±¡çš„åˆ›å»ºã€‚æ§åˆ¶åè½¬æ§åˆ¶çš„æ˜¯ä»€ä¹ˆï¼Ÿæ§åˆ¶çš„æ˜¯å¤–éƒ¨èµ„æºçš„è·å–ï¼ŒåŒ…æ‹¬å¯¹è±¡ã€æ–‡ä»¶ç­‰ã€‚ä¸ºä»€ä¹ˆæ˜¯åè½¬ï¼Ÿå› ä¸ºå®¹å™¨å¸®æˆ‘ä»¬æŸ¥æ‰¾åŠæ³¨å…¥ä¾èµ–å¯¹è±¡ï¼Œå¯¹è±¡åªæ˜¯è¢«åŠ¨çš„æ¥å—ä¾èµ–å¯¹è±¡ï¼Œä¾èµ–å¯¹è±¡çš„è·å–è¢«åè½¬äº†ã€‚

IOC æœ‰å‡ ç§å®ç°æ–¹å¼ã€‚ä¸€ç§æ˜¯ DIï¼ˆDependency Injectï¼‰ä¾èµ–æ³¨å…¥ã€‚ä¸€ç§æ˜¯ XMLã€‚

åœ¨å®ç°ä¾èµ–æ³¨å…¥çš„è¿‡ç¨‹ä¸­ä¸ºäº†è¾¾åˆ°æ— ä¾µå…¥å¼æ³¨å…¥å‡ºç°äº†ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå«é¢å‘åˆ‡é¢ç¼–ç¨‹ AOPã€‚

AOP æŠŠè½¯ä»¶ç³»ç»Ÿåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†:æ ¸å¿ƒå…³æ³¨ç‚¹å’Œæ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œå®ç°å…³æ³¨ç‚¹åˆ†ç¦»ã€‚å®ƒå°†é‚£äº›å½±å“äº†å¤šä¸ªç±»çš„å…¬å…±è¡Œä¸ºå°è£…åˆ°ä¸€ä¸ªå¯é‡ç”¨æ¨¡å—ï¼Œå¹¶å°†å…¶å‘½åä¸º"Aspect"ï¼Œå³åˆ‡é¢ã€‚æ‰€è°“"åˆ‡é¢"ï¼Œç®€å•è¯´å°±æ˜¯é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œå´ä¸ºä¸šåŠ¡æ¨¡å—æ‰€å…±åŒè°ƒç”¨çš„é€»è¾‘æˆ–è´£ä»»å°è£…èµ·æ¥ï¼Œä¾¿äºå‡å°‘ç³»ç»Ÿçš„é‡å¤ä»£ç ï¼Œé™ä½æ¨¡å—ä¹‹é—´çš„è€¦åˆåº¦ï¼Œå¹¶æœ‰åˆ©äºæœªæ¥çš„å¯æ“ä½œæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

## awilix

ä¸€ä¸ªéå¸¸å°å·§çš„åº“ï¼Œç»è¿‡ä¸‹é¢çš„ä»£ç é…ç½®ï¼Œå°±å¯ä»¥å®ç°ä¸€ä¸ª Node ç«¯çš„ IOC æ¡†æ¶ã€‚å®ƒçš„ç¼ºç‚¹æ˜¯æ²¡æœ‰å¤ªå¤šç›¸å…³æ–‡æ¡£ï¼Œå‚è€ƒè¾ƒå°‘ã€‚

```javascript
import { loadControllers, scopePerRequest } from "awilix-koa";
import { asClass, asValue, Lifetime, createContainer } from "awilix";

//æ•´ä¸ªIOCçš„è¿‡ç¨‹æ¥è®² å®¹å™¨æœ€é‡è¦
const container = createContainer();
//è¦æ³¨å…¥çš„æ‰€æœ‰ç±»è£…è½½åˆ°containerä¸­
container.loadModules([__dirname + "/services/*.js"], {
  //åˆ¶å®šä»¥ä¸‹å½“å‰çš„æ³¨å…¥çš„å‡½æ•° æ˜¯å·²ä»€ä¹ˆå½¢å¼
  formatName: "camelCase",
  resolverOptions: {
    lifetime: Lifetime.SCOPED,
  },
});

app.use(scopePerRequest(container));

//è‡ªåŠ¨çš„å»è£…è½½è·¯ç”±
app.use(loadControllers(__dirname + "/controllers/*.js"));

app.listen(config.port, () => {
  console.log("æœåŠ¡å·²å¯åŠ¨ğŸºğŸï¼Œç«¯å£å·:", config.port);
});
```

## inversify
