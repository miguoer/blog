(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{523:function(t,s,a){"use strict";a.r(s);var r=a(42),e=Object(r.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"如何做一个监控-sdk"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何做一个监控-sdk"}},[t._v("#")]),t._v(" 如何做一个监控 SDK")]),t._v(" "),a("p",[t._v("监控 SDK 主要完成性能监控、错误监控和用户操作轨迹+sourcemap 回溯的功能。")]),t._v(" "),a("h2",{attrs:{id:"sdk-开发准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sdk-开发准备"}},[t._v("#")]),t._v(" SDK 开发准备")]),t._v(" "),a("ol",[a("li",[t._v("准备编译环境 ts/js 文件")]),t._v(" "),a("li",[t._v("选择构建工具。可供选择的有 rollup, esbuild, swc 等。rollup 是老大哥。")]),t._v(" "),a("li",[t._v("目标是要编译成兼容 umd cmd amd esmodule commonjs1 commonjs2 等规范的 min.js 文件。rollup 可以方便的生成这些模块化的 js。缺点就是有点繁琐。")])]),t._v(" "),a("p",[t._v("还有一个小而美的框架叫 microbundle，可以不用像 rollup 一样配置各种，简单的就可以生成各种规范的 js。")]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("使用 api-extractor 合并分散的.d.ts 文件，输出到 dist/typings 下")]),t._v(" "),a("li",[t._v("生成 ts-doc 文件。可以使用 typedoc")])]),t._v(" "),a("h2",{attrs:{id:"性能监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#性能监控"}},[t._v("#")]),t._v(" 性能监控")]),t._v(" "),a("p",[t._v("性能监控，可以使用 performance.timing API 和 web-vitals 库来完成")]),t._v(" "),a("h2",{attrs:{id:"错误监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误监控"}},[t._v("#")]),t._v(" 错误监控")]),t._v(" "),a("ul",[a("li",[t._v("使用 window.onerror 捕获 JS 执行报错")]),t._v(" "),a("li",[t._v("使用 window.addEventListener('unhandledrejection', ()=> {}) 用于捕获未处理的 Promise 报错")])]),t._v(" "),a("h2",{attrs:{id:"上报"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上报"}},[t._v("#")]),t._v(" 上报")]),t._v(" "),a("p",[t._v("使用如果支持 navigator.sendBeacon，就使用\nnavigator.sendBeacon(logurl, JSON.stringify(msg));")]),t._v(" "),a("p",[t._v("如果不支持就用 fetch")])])}),[],!1,null,null,null);s.default=e.exports}}]);